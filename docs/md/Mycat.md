# Mycat

## 1、什么是Mycat

   从定义和分类来看，它是一个开源的分布式数据库系统，是一个实现了MySQL 协议的的Server，前端用户可以把它看作是一个数据库代理，用MySQL 客户端工具和命令行访问，而其后端可以用MySQL 原生（Native）协议与多个MySQL 服务器通信，也可以用JDBC 协议与大多数主流数据库服务器通信，其核心功能是分表分库，即将一个大表水平分割为N 个小表，存储在后端MySQL 服务器里或者其他数据库里。

   Mycat 发展到目前的版本，已经不是一个单纯的MySQL 代理了，它的后端可以支持MySQL、SQLServer、Oracle、DB2、PostgreSQL 等主流数据库，也支持MongoDB 这种新型NoSQL 方式的存储

## 2、Mycat的作用

### 2.1读写分离



### 2.2 分库分表

**单表的数据太多考虑水平拆分；单库的表太多考虑垂直拆分。**

单表记录数量突破性能上限时，如MySQL单表上限估计在近千万条内，当记录数继续增长时，从性能考虑，则需要进行**水平拆分**。

如果数据库的QPS每秒查询率(Query Per Second) 过高，就需要考虑**垂直拆分**，通过分库来分担单个数据库的连接压力。比如，如果查询QPS为3500，假设单库可以支撑1000个连接数的话，那么就可以考虑拆分成4个库，来分散查询连接压力



### 2.3 主从同步（多数据源处理）



## 3、Mycat常见概念

**逻辑库(schema)**
通常对实际应用来说，并不需要知道中间件的存在，业务开发人员只需要知道数据库的概念，所以数据库中间件可以被看做是一个或多个数据库集群构成的逻辑库。

**逻辑表（table）**
既然有逻辑库，那么就会有逻辑表，分布式数据库中，对应用来说，读写数据的表就是逻辑表。逻辑表，可以是数据切分后，分布在一个或多个分片库中，也可以不做数据切分，不分片，只有一个表构成。

**分片表**
分片表，是指那些原有的很大数据的表，需要切分到多个数据库的表，这样，每个分片都有一部分数据，所有分片构成了完整的数据。

**非分片表**
一个数据库中并不是所有的表都很大，某些表是可以不用进行切分的，非分片是相对分片表来说的，就是那些不需要进行数据切分的表。

**ER 表**
关系型数据库是基于实体关系模型（Entity-Relationship Model)之上，通过其描述了真实世界中事物与关系，Mycat 中的ER 表即是来源于此。根据这一思路，提出了基于E-R 关系的数据分片策略，子表的记录与所关联的父表记录存放在同一个数据分片上，即子表依赖于父表，通过表分组（Table Group）保证数据Join 不会跨库操作。

表分组（Table Group）是解决跨分片数据join 的一种很好的思路，也是数据切分规划的重要一条规则。

**全局表**
一个真实的业务系统中，往往存在大量的类似字典表的表，这些表基本上很少变动，字典表具有以下几个特性：

• 变动不频繁；

• 数据量总体变化不大；

• 数据规模不大，很少有超过数十万条记录。

对于这类的表，在分片的情况下，当业务表因为规模而进行分片以后，业务表与这些附属的字典表之间的关联，就成了比较棘手的问题，所以Mycat 中通过数据冗余来解决这类表的join，即所有的分片都有一份数据的拷贝，所有将字典表或者符合字典表特性的一些表定义为全局表。

数据冗余是解决跨分片数据join 的一种很好的思路，也是数据切分规划的另外一条重要规则。


## 4、Mycat原理

   Mycat 的原理中最重要的一个动词是“拦截”，它拦截了用户发送过来的SQL 语句，首先对SQL 语句做了一些特定的分析：如分片分析、路由分析、读写分离分析、缓存分析等，然后将此SQL 发往后端的真实数据库，并将返回的结果做适当的处理，最终再返回给用户。



## 5、安装与部署



## 6、配置说明



## 7、备注



## 8、Mycat常见面试题

8.1 单表数据达到多少的时候会影响数据库的查询性能？为什么？
答：一般mysql达到100w，就影响数据库的查询性能，如果命中索引，情况还好一点。

8.2  主从复制机制的原理概述是怎样的？常见的存在形式有哪些？
答：mysql主从复制是master将所有的事务操作写入到binlog,slave获取binlog读入自己的中继区，然后再进行执行。

8.3 分库分表中解释一下垂直和水平2种不同的拆分？
答：垂直拆分：是将单表，或者是有关联的表放在一个数据库，把原有的一个数据库拆分成若干个数据库。水平拆分：是将一个很大的表，通过取模，按照日期范围等等拆分成若干个小表

8.4  分库分表中垂直分库方案会带来哪些问题？
答：单表的数据量还是会很大。

8.5 分布式数据存储中间件如mycat的核心流程是什么？
答：sql解析 ->数据源分配 -> 请求响应 -> 结果整合

8.6  概述一下mycat？
答：分布式关系型数据库解决方案

8.7 解释一下全局表，ER表，分片表？
答：全局表：一个字典类数据的表，每个表都有可能用到，在各个数据节点上都会冗余。
分片表：按照一定的规则后，表按照设置的primaryKey来分配到不同的数据节点上。
ER表：和分片表有外键关系的表，也是通过设置的primaryKey即与分片表的外键，和分片表按照一样的规则分配到不同的数据节点上。